<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kalkulator mocy↔prądu (1F/3F) – wersja offline</title>
  <style>
    :root { --bg:#fff5f5; --card:#fff; --border:#fca5a5; --text:#111827; --muted:#7f1d1d; --brand:#b91c1c; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; background:var(--bg); color:var(--text); }
    .container { max-width: 960px; margin: 0 auto; padding: 24px; }
    h1 { font-size: clamp(20px, 3vw, 28px); margin: 0 0 6px; }
    p.sub { color:var(--muted); margin: 0 0 16px; font-size: 14px; }
    .grid { display:grid; gap:12px; }
    @media (min-width: 768px){ .grid-3 { grid-template-columns: repeat(3, minmax(0,1fr)); } .grid-2 { grid-template-columns: repeat(2, minmax(0,1fr)); } }
    .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow: 0 1px 2px rgba(0,0,0,.05); }
    .segmented { display:flex; gap:6px; background:#fff; border:1px solid var(--border); padding:6px; border-radius:999px; }
    .segmented button {
      flex:1;
      border:0;
      background:transparent;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      color:#374151;
      font-size:14px;
      transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, transform 0.18s ease;
    }
    .segmented button:hover { background:#fee2e2; }
    .segmented button:active { transform: scale(0.99); }
    .segmented button.active { background:var(--brand); color:#fff; box-shadow: 0 3px 10px rgba(0,0,0,.12); transform: translateY(-1px); }
    .segmented button.pulse { animation: pulseTap 0.28s ease; }
    label .lab { display:block; font-size: 13px; font-weight:600; margin-bottom:6px; }
    input[type="number"], select { width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:12px; font-size:14px; }
    input[type="range"] {
      width:100%;
      height:10px;
      appearance:none;
      background: linear-gradient(90deg, var(--brand) 50%, #fee2e2 50%);
      border-radius:999px;
      outline:none;
      accent-color: var(--brand);
      box-shadow: inset 0 1px 2px rgba(0,0,0,.12);
      transition: background 0.2s ease, box-shadow 0.2s ease;
    }
    input[type="range"]:focus-visible { box-shadow: 0 0 0 2px rgba(185,28,28,.25), inset 0 1px 2px rgba(0,0,0,.12); }
    input[type="range"]::-webkit-slider-thumb {
      appearance:none;
      width:18px;
      height:18px;
      border-radius:50%;
      background:#fff;
      border:2px solid var(--brand);
      box-shadow: 0 2px 4px rgba(0,0,0,.2);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    input[type="range"]::-moz-range-thumb {
      width:18px;
      height:18px;
      border-radius:50%;
      background:#fff;
      border:2px solid var(--brand);
      box-shadow: 0 2px 4px rgba(0,0,0,.2);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    input[type="range"]::-moz-range-track { background: transparent; border: none; }
    input[type="range"]:active::-webkit-slider-thumb,
    input[type="range"]:active::-moz-range-thumb { transform: scale(1.1); box-shadow: 0 3px 6px rgba(0,0,0,.25); }
    input[type="range"].spark { box-shadow: 0 0 0 3px rgba(185,28,28,.15), 0 0 18px rgba(185,28,28,.25); animation: surgeTrack 0.35s ease; }
    input[type="range"].spark::-webkit-slider-thumb,
    input[type="range"].spark::-moz-range-thumb { animation: surgeThumb 0.35s ease; }
    .pop-in { animation: fadeSlideIn 0.24s ease; }
    @keyframes fadeSlideIn { from { opacity:0; transform: translateY(8px); } to { opacity:1; transform: translateY(0); } }
    @keyframes pulseTap { 0% { transform: scale(1); } 50% { transform: scale(0.97); } 100% { transform: scale(1); } }
    @keyframes surgeTrack { 0% { filter: brightness(1.05); } 50% { box-shadow: 0 0 0 4px rgba(185,28,28,.25), 0 0 20px rgba(185,28,28,.35); filter: brightness(1.2); } 100% { filter: brightness(1.05); } }
    @keyframes surgeThumb { 0% { transform: scale(1.05); box-shadow: 0 0 0 0 rgba(185,28,28,.3); } 50% { transform: scale(1.18); box-shadow: 0 0 18px rgba(185,28,28,.45); } 100% { transform: scale(1.05); box-shadow: 0 2px 4px rgba(0,0,0,.2); } }
    .input-invalid { border-color:#b91c1c; background:#fef2f2; }
    .row { display:flex; justify-content:space-between; align-items:center; padding:6px 0; }
    .muted { color:var(--muted); }
    .warn { color:#b91c1c; font-size: 13px; margin-top:8px; }
    .small { font-size: 13px; }
    .footer { color:var(--muted); font-size:12px; margin-top:4px; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid var(--border); border-radius:999px; font-size:12px; color:#374151; background:#fff; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>⚡ Kalkulator mocy ↔ prądu (1F / 3F) – offline</h1>
      <p class="sub">Działa w czystym HTML + JS (bez builda). Otwórz ten plik w przeglądarce – wszystko działa offline.</p>
    </header>

    <div class="grid grid-3" style="margin-bottom:12px">
      <div>
        <div class="small" style="font-weight:600; margin-bottom:6px">Układ</div>
        <div class="segmented" id="phaseSeg">
          <button data-value="1F" class="active">1‑fazowy 230 V</button>
          <button data-value="3F">3‑fazowy 400 V</button>
        </div>
      </div>
      <div>
        <div class="small" style="font-weight:600; margin-bottom:6px">Tryb</div>
        <div class="segmented" id="modeSeg">
          <button data-value="inputs" class="active">Pola</button>
          <button data-value="sliders">Suwaki</button>
        </div>
      </div>
      <div>
        <div class="small" style="font-weight:600; margin-bottom:6px">Kierunek</div>
        <div class="segmented" id="dirSeg">
          <button data-value="IfromP" class="active">I z P</button>
          <button data-value="PfromI">P z I</button>
        </div>
      </div>
    </div>

    <!-- Tryb: POLA  -->
    <section id="panelInputs" class="card">
      <div class="grid grid-2">
        <div>
          <div id="inputsIfromP">
            <div class="grid" style="gap:10px">
              <label>
                <span class="lab">Moc P</span>
                <div class="grid" style="grid-template-columns:1fr 120px; gap:8px">
                  <input id="Pnum" type="number" step="any" value="5" />
                  <select id="Punit">
                    <option value="kW">kW</option>
                    <option value="W">W</option>
                  </select>
                </div>
              </label>
              <label>
                <span class="lab">cos φ</span>
                <input id="cosfi" type="number" step="0.01" min="0" max="1" value="0.95" />
              </label>
              <div class="card" style="padding:10px">
                <span class="muted">Napięcie U:</span> <strong id="Uinfo">230 V</strong>
                <span class="pill" id="phaseInfo" style="margin-left:8px">1‑fazowy</span>
              </div>
            </div>
          </div>

          <div id="inputsPfromI" style="display:none">
            <div class="grid" style="gap:10px">
              <label>
                <span class="lab">Prąd I [A]</span>
                <input id="Inum" type="number" step="any" value="10" />
              </label>
              <label>
                <span class="lab">cos φ</span>
                <input id="cosfi2" type="number" step="0.01" min="0" max="1" value="0.95" />
              </label>
              <div class="card" style="padding:10px">
                <span class="muted">Napięcie U:</span> <strong id="Uinfo2">230 V</strong>
                <span class="pill" id="phaseInfo2" style="margin-left:8px">1‑fazowy</span>
              </div>
            </div>
          </div>
        </div>

        <div>
          <div class="card">
            <h3 style="margin:0 0 6px">Wynik</h3>
            <div id="resultInputs"></div>
            <div id="warnInputs" class="warn" style="display:none">Uwaga: cos φ musi być w zakresie (0, 1].</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tryb: SUWAKI -->
    <section id="panelSliders" class="card" style="display:none">
      <div class="grid grid-2">
        <div>
          <div id="slidersIfromP">
            <label>
              <span class="lab">Moc P [kW]</span>
              <input id="Pslide" type="range" min="0" max="200" step="0.1" value="10" />
              <div class="footer"><span class="muted">P =</span> <strong id="PslideVal">10.0 kW</strong></div>
            </label>
            <label>
              <span class="lab">cos φ</span>
              <input id="cosfiSlide" type="range" min="0.1" max="1" step="0.01" value="0.9" />
              <div class="footer"><span class="muted">cos φ =</span> <strong id="cosSlideVal">0.90</strong></div>
            </label>
            <div class="card" style="padding:10px">
              <span class="muted">Napięcie U:</span> <strong id="UinfoS">230 V</strong>
              <span class="pill" id="phaseInfoS" style="margin-left:8px">1‑fazowy</span>
            </div>
          </div>

          <div id="slidersPfromI" style="display:none">
            <label>
              <span class="lab">Prąd I [A]</span>
              <input id="Islide" type="range" min="0" max="500" step="0.1" value="16" />
              <div class="footer"><span class="muted">I =</span> <strong id="IslideVal">16.0 A</strong></div>
            </label>
            <label>
              <span class="lab">cos φ</span>
              <input id="cosfiSlide2" type="range" min="0.1" max="1" step="0.01" value="0.9" />
              <div class="footer"><span class="muted">cos φ =</span> <strong id="cosSlideVal2">0.90</strong></div>
            </label>
            <div class="card" style="padding:10px">
              <span class="muted">Napięcie U:</span> <strong id="UinfoS2">230 V</strong>
              <span class="pill" id="phaseInfoS2" style="margin-left:8px">1‑fazowy</span>
            </div>
          </div>
        </div>

        <div>
          <div class="card">
            <h3 style="margin:0 0 6px">Wynik</h3>
            <div id="resultSliders"></div>
            <div id="warnSliders" class="warn" style="display:none">Uwaga: cos φ musi być w zakresie (0, 1].</div>
            <div class="footer">Przesuwaj suwaki, aby zobaczyć wpływ parametrów na wynik.</div>
          </div>
        </div>
      </div>
    </section>

    <section style="margin-top:16px">
      <div class="card small">
        <h3 style="margin:0 0 8px">Wzory</h3>
        <ul style="margin:0 0 6px 18px; padding:0">
          <li><strong>1‑fazowo:</strong> P = U · I · cosφ → I = P / (U · cosφ), U = 230 V</li>
          <li><strong>3‑fazowo:</strong> P = √3 · U · I · cosφ → I = P / (√3 · U · cosφ), U = 400 V</li>
        </ul>
        <div class="footer">Moc P rozumiana jako czynna (W). Zakres: 0 &lt; cosφ ≤ 1.</div>
      </div>
    </section>
  </div>

  <script>
    // Stałe i stan
    const SQRT3 = Math.sqrt(3);
    let phase = '1F'; // '1F' | '3F'
    let mode = 'inputs'; // 'inputs' | 'sliders'
    let dir = 'IfromP'; // 'IfromP' | 'PfromI'

    // Pomocnicze
    const $ = (sel) => document.querySelector(sel);
    const fmt = (num, unit) => {
      if (num == null || !isFinite(num)) return '—';
      const v = Number(num);
      const str = Math.abs(v) >= 1000 ? v.toLocaleString(undefined, { maximumFractionDigits: 1 }) : v.toFixed(3);
      return unit ? str + ' ' + unit : str;
    };

    const Uval = () => phase === '1F' ? 230 : 400;
    const kickAnim = (el, cls='pop-in') => {
      if (!el) return;
      el.classList.remove(cls);
      void el.offsetWidth;
      el.classList.add(cls);
    };
    const flashSpark = (el) => {
      if (!el) return;
      el.classList.add('spark');
      setTimeout(()=>el.classList.remove('spark'), 220);
    };
    const setRangeBg = (el) => {
      if (!el) return;
      const min = parseFloat(el.min || '0');
      const max = parseFloat(el.max || '1');
      const val = parseFloat(el.value || '0');
      const pct = max === min ? 0 : ((val - min) / (max - min)) * 100;
      el.style.background = `linear-gradient(90deg, var(--brand) ${pct}%, #fee2e2 ${pct}%)`;
    };

    function calcI(P_W, U_V, c, is3F){
      if (!c || c <= 0 || c > 1) return null;
      const denom = is3F ? (U_V * SQRT3 * c) : (U_V * c);
      if (denom === 0) return null;
      return P_W / denom; // A
    }
    function calcP(I_A, U_V, c, is3F){
      if (!c || c <= 0 || c > 1) return null;
      const factor = is3F ? (U_V * SQRT3 * c) : (U_V * c);
      return I_A * factor; // W
    }

    function derivedPowers(P_W, c){
      if (!P_W || !c || c <= 0 || c > 1) return { S:null, Q:null };
      const S = P_W / c;
      const phi = Math.acos(Math.min(1, Math.max(0, c)));
      const Q = P_W * Math.tan(phi);
      return { S, Q };
    }

    function pickProtection(I){
      const normalized = (typeof I === 'number' && isFinite(I)) ? I : null;
      if (normalized === null || normalized <= 0) return { Ib:null };
      const steps = [6, 10, 13, 16, 20, 25, 32, 40, 50, 63, 80, 100, 125, 160, 200, 250, 315, 400];
      const Ib = steps.find(step => normalized <= step) ?? steps[steps.length - 1];
      return { Ib };
    }

    function validateCos(inputEl){
      const c = parseFloat(inputEl.value || '');
      const valid = c > 0 && c <= 1;
      inputEl.classList.toggle('input-invalid', !valid && inputEl.type === 'number');
      return { c, valid };
    }

    // Elementy segmented
    function bindSegmented(id, onChange){
      const root = document.getElementById(id);
      root.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          root.querySelectorAll('button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          kickAnim(btn, 'pulse');
          onChange(btn.getAttribute('data-value'));
        });
      });
    }

    bindSegmented('phaseSeg', (v)=>{ phase = v; updatePhaseLabels(); recalc(); });
    bindSegmented('modeSeg',  (v)=>{ mode  = v; updateVisibility(); recalc(); });
    bindSegmented('dirSeg',   (v)=>{ dir   = v; updateVisibility(); recalc(); });

    function updatePhaseLabels(){
      const U = Uval();
      // Inputs
      $('#Uinfo').textContent  = U + ' V';
      $('#phaseInfo').textContent = phase === '1F' ? '1‑fazowy' : '3‑fazowy';
      $('#Uinfo2').textContent = U + ' V';
      $('#phaseInfo2').textContent = phase === '1F' ? '1‑fazowy' : '3‑fazowy';
      // Sliders
      $('#UinfoS').textContent  = U + ' V';
      $('#phaseInfoS').textContent = phase === '1F' ? '1‑fazowy' : '3‑fazowy';
      $('#UinfoS2').textContent = U + ' V';
      $('#phaseInfoS2').textContent = phase === '1F' ? '1‑fazowy' : '3‑fazowy';
    }

    function updateVisibility(){
      // tryb
      $('#panelInputs').style.display  = mode === 'inputs' ? '' : 'none';
      $('#panelSliders').style.display = mode === 'sliders' ? '' : 'none';
      // kierunek w ramach trybu
      $('#inputsIfromP').style.display = (mode==='inputs' && dir==='IfromP') ? '' : 'none';
      $('#inputsPfromI').style.display = (mode==='inputs' && dir==='PfromI') ? '' : 'none';
      $('#slidersIfromP').style.display = (mode==='sliders' && dir==='IfromP') ? '' : 'none';
      $('#slidersPfromI').style.display = (mode==='sliders' && dir==='PfromI') ? '' : 'none';
      const toAnim = [];
      if (mode === 'inputs'){
        toAnim.push($('#panelInputs'));
        toAnim.push(dir === 'IfromP' ? $('#inputsIfromP') : $('#inputsPfromI'));
      } else {
        toAnim.push($('#panelSliders'));
        toAnim.push(dir === 'IfromP' ? $('#slidersIfromP') : $('#slidersPfromI'));
      }
      toAnim.forEach(kickAnim);
    }

    // Powiązania wejść (inputs)
    const Pnum = $('#Pnum');
    const Punit = $('#Punit');
    const cosfi = $('#cosfi');
    const Inum = $('#Inum');
    const cosfi2 = $('#cosfi2');

    [Pnum, Punit, cosfi, Inum, cosfi2].forEach(el => el.addEventListener('input', recalc));

    // Suwaki
    const Pslide = $('#Pslide');
    const cosfiSlide = $('#cosfiSlide');
    const Islide = $('#Islide');
    const cosfiSlide2 = $('#cosfiSlide2');

    [Pslide, cosfiSlide, Islide, cosfiSlide2].forEach(setRangeBg);

    Pslide.addEventListener('input', ()=>{ setRangeBg(Pslide); flashSpark(Pslide); $('#PslideVal').textContent = Number(Pslide.value).toFixed(1) + ' kW'; recalc(); });
    cosfiSlide.addEventListener('input', ()=>{ setRangeBg(cosfiSlide); flashSpark(cosfiSlide); $('#cosSlideVal').textContent = Number(cosfiSlide.value).toFixed(2); recalc(); });
    Islide.addEventListener('input', ()=>{ setRangeBg(Islide); flashSpark(Islide); $('#IslideVal').textContent = Number(Islide.value).toFixed(1) + ' A'; recalc(); });
    cosfiSlide2.addEventListener('input', ()=>{ setRangeBg(cosfiSlide2); flashSpark(cosfiSlide2); $('#cosSlideVal2').textContent = Number(cosfiSlide2.value).toFixed(2); recalc(); });

    function recalc(){
      const U = Uval();
      const is3 = (phase === '3F');

      // Inputs mode
      if (mode === 'inputs'){
        const warn = $('#warnInputs');
        const parts = [];
        if (dir === 'IfromP'){
          const P_val = parseFloat(Pnum.value || '0');
          const P_W = (Punit.value === 'kW') ? P_val * 1000 : P_val;
          const { c, valid } = validateCos(cosfi);
          const I = calcI(P_W, U, c, is3);
          parts.push(row('Prąd I', '<strong>' + fmt(I,'A') + '</strong>'));
          parts.push(row('P [W] (obliczane)', fmt(P_W,'W')));
          appendProtection({ parts, I });
          appendPowerDetails({ parts, P_W, c });
          warn.style.display = valid ? 'none' : '';
        } else {
          const I_val = parseFloat(Inum.value || '0');
          const { c, valid } = validateCos(cosfi2);
          const P_W = calcP(I_val, U, c, is3);
          parts.push(row('Moc P (W)', '<strong>' + fmt(P_W,'W') + '</strong>'));
          parts.push(row('Moc P (kW)', '<strong>' + fmt(P_W ? P_W/1000 : null,'kW') + '</strong>'));
          appendProtection({ parts, I: I_val });
          appendPowerDetails({ parts, P_W, c });
          warn.style.display = valid ? 'none' : '';
        }
        $('#resultInputs').innerHTML = parts.join('');
      }

      // Sliders mode
      if (mode === 'sliders'){
        const warn = $('#warnSliders');
        const parts = [];
        if (dir === 'IfromP'){
          const P_kW = parseFloat(Pslide.value || '0');
          const P_W = P_kW * 1000;
          const c = parseFloat(cosfiSlide.value || '0');
          const I = calcI(P_W, U, c, is3);
          parts.push(row('Prąd I', '<strong>' + fmt(I,'A') + '</strong>'));
          parts.push(row('P [W] (wejście)', fmt(P_W,'W')));
          appendProtection({ parts, I });
          appendPowerDetails({ parts, P_W, c });
          warn.style.display = (c > 0 && c <= 1) ? 'none' : '';
        } else {
          const I_val = parseFloat(Islide.value || '0');
          const c = parseFloat(cosfiSlide2.value || '0');
          const P_W = calcP(I_val, U, c, is3);
          parts.push(row('Moc P (W)', '<strong>' + fmt(P_W,'W') + '</strong>'));
          parts.push(row('Moc P (kW)', '<strong>' + fmt(P_W ? P_W/1000 : null,'kW') + '</strong>'));
          appendProtection({ parts, I: I_val });
          appendPowerDetails({ parts, P_W, c });
          warn.style.display = (c > 0 && c <= 1) ? 'none' : '';
        }
        $('#resultSliders').innerHTML = parts.join('');
      }
    }

    function row(label, valueHtml){
      return '<div class="row"><span class="muted">' + label + '</span><span>' + valueHtml + '</span></div>';
    }

    function appendPowerDetails({ parts, P_W, c }){
      const { S, Q } = derivedPowers(P_W, c);
      parts.push(row('Moc pozorna S', fmt(S, 'VA')));
      parts.push(row('Moc bierna Q', fmt(Q, 'var')));
    }

    function appendProtection({ parts, I }){
      const { Ib } = pickProtection(I);
      const label = Ib ? 'Wyłącznik nadprądowy (Ib = ' + fmt(Ib, 'A') + ')' : '—';
      parts.push(row('Dobór zabezpieczenia', label));
    }

    // Inicjalizacja UI
    updatePhaseLabels();
    updateVisibility();
    recalc();
  </script>
</body>
</html>
